Refactored to make use of classes.